{{ define "body" }}
<script> 
jQuery(document).ready(function($) {
    var animation = false;
    var availableCommands = [
        "all", "whois", 'social', 'work', 'education',
        'skills', 'softskills', 'languages', 'projects',
        {{ if .Site.Params.certifications }} 'certifications', {{ end }}
        {{ if .Site.Params.startxLocation }} 'startx', {{ end }}
        {{ if .Site.Params.exitLocation }} 'exit', {{ end }}
        {{ if .Site.Params.misc }}{{ .Site.Params.misc.commandName | default "misc"}},{{end}}
        {{ if not .Site.Params.source }} 'source',{{ end }}
        {{ if .Site.Params.version }} 'version', {{ end }}
    ]

    $('body').terminal(function(command, term) {

        
        //Funciton used by StartX to draw the progressBar
        function progress(percent, width) {
            var size = Math.round(width*percent/100);
            var left = '', taken = '', i;
            for (i=size; i--;) {
                taken += '=';
            }
            if (taken.length > 0) {
                taken = taken.replace(/=$/, '>');
            }
            for (i=width-size; i--;) {
                left += ' ';
            }
            return '[' + taken + left + '] ' + percent + '%';
        }

        function loading () {
            var i = 0, size = 30;
            prompt = term.get_prompt();
            string = progress(0, size);
            term.set_prompt(progress);
            animation = true;
            (function loop() {
                string = progress(i++, size);
                term.set_prompt(string);
                if (i < 100) {
                    timer = setTimeout(loop, 10);
                } else {
                    term.echo(progress(i, size) + ' [[b;green;]OK]').set_prompt(prompt);
                    animation = false
                }
            })();
        }

        function progressBar(number) {
            var barLength = Math.round(number / 10);
            var barFilled = Array(barLength + 1).join("&#9611;");
            var barBlank= Array(11 - barLength).join("&#9617;");

            return barFilled + barBlank
        }

        function echoArray(array) {
            for (i = 0; i < array.length; i += 1) {
                term.echo(array[i]);
            }
        }

        var whois = [
        {{ with .Site.Params.whois }} 
            '[[b;grey;]Name:]\t\t\t{{ .name }}\n' + 
            '[[b;grey;]Profession:]\t\t{{ .profession }}\n' +
            '[[b;grey;]Location:]\t\t{{ .location }}\n' +
            {{ if .email }}
            '[[b;grey;]Email:]\t\t\t{{ .email }}\n' +
            {{ end }}
            {{ if .homelink }}
            '[[b;grey;]Homepage:]\t\t{{ .homelink }}\n' +
            {{ end }}
            {{ if .description }}
            '{{ .description }}' +
            {{ end }}
            '\r',
        {{ end }}
        ];

        var social = [
        {{ if .Site.Params.hideSocialName }}
            {{ with .Site.Params.social }}
                {{ range . }} 
                '{{ .url }}',
                {{ end }}
                '\r',
            {{ end }}
        {{ else }}
            {{ with .Site.Params.social }}
                {{ range . }}
                '{{ .name }}: {{ .url }}',
                {{ end }}
                '\r',
            {{ end }}
        {{ end }}
        ];

        var certifications = [
        {{ with .Site.Params.certifications }}
            {{ range . }}
                '---\n' +
                '[[b;{{ .color | default "grey" }};]{{ .certName }}]\n' +
                '{{ .date }}\n' +
                {{ if .company }}
                '{{ .company }}\n' +
                {{ end }}
                {{ if .description }}
                '{{ .description }}\n' +
                {{ end }}
                '\r',
            {{ end }}
        {{ end }}
        ];
        
        var work = [
        {{ with .Site.Params.work }}
            {{ range .}}
                '---\n' +
                '[[b;{{ .color | default "grey" }};]{{ .jobTitle }}]\n' +
                '{{ .company }}\n' +
                '{{ .location}}\n' +
                '{{ .date }}\n' +
                '\n' +
                '{{ .description }}' +
                '\r',
            {{ end }}
        {{ end }}
        ];

        var education = [
        {{ with .Site.Params.education }}
            {{ range . }}
                '---\n' +
                '[[b;{{ .color | default "grey" }};]{{ .courseName }}]\n' +
                '{{ .date }}\n' +
                {{ if .description }}
                    "{{ .description }}\n" +
                {{ end }}
                "\r",
            {{ end }}
        {{ end }}
        ];

        var projects = [
        {{ with .Site.Params.projects }}
            {{ range .}}
                '---\n' +
                '[[b;{{ .color | default "grey" }};]{{ .title }}]\n' +
                '{{ .date }}\n' +
                '{{ .link }}\n' +
                {{ if .description }}
                '{{ .description }}\n' +
                {{ end }}
                "\r",
          {{ end }}
        {{ end }}
        ]

        var skills = [
        {{ with .Site.Params.skills }}
            {{ range . }}
                '[[b;{{ .color | default "grey" }};]{{ .name }}:]\n' +
                progressBar({{ .percentage }}) +
                '{{ .percentage }}' + '%\n' +
                {{ if .description }}
                '{{ .description }}\n' +
                {{ end }}
                '\r',
            {{ end }}
        {{ end }}
        ]

        var softSkills = [
        {{ with .Site.Params.softSkills }}
            {{ range . }}
                '[[b;{{ .color | default "grey" }};]{{ .name }}:]\n' +
                progressBar({{ .percentage }}) +
                '{{ .percentage }}' + '%\n' + 
                {{ if .description }}
                '{{ .description }}\n' +
                {{ end }}
                '\r',
            {{ end }}
        {{ end }}
        ]
      
        var languages = [
        {{ with .Site.Params.languages }}
            {{ range . }}
                '[[b;{{ .color | default "grey" }};]{{ .name }}:]\n' +
                progressBar({{ .percentage }})+ 
                '{{ .percentage }}' + '%\n' +
                {{ if .description }}
                '{{ .description }}\n' +
                {{ end }}
                '\r',
            {{ end }}
        {{ end }}
        ]
    
         var misc = [
             {{ with .Site.Params.misc }}
            '[[b;{{ .titleColor }};]{{ .title }}]\n' +
            '[[;{{ .contentColor }};]{{ .content }}]\n',
             {{ end }}
        ]

        var help = '\n[[b;white;]Available commands:]\n' +
                      '\n\t\t' + availableCommands.join(' ') + '\n';

        var source =  '        _______            \n' +
                      '       |       |           \n' +
                      '       |       |           \n' +
                      '       |_______|_______    \n' +
                      '               |       |   \n' +
                      '               |       |   \n' +
                      ' ______________|_______|   \n' +
                      '|      |       |       |   \n' +
                      '|      |       |       |   \n' +
                      '|______|_______|_______|   \n' +
                      '[[;red;]May the source be with you]\n' +
                      '[[;grey;]https://github.com/coolapso/hugo-theme-terminalcv\n';

        all = [ 
            whois,
            social,
            work,
            education,
            skills,
            softSkills,
            languages,
            projects,
            certifications,
            misc,
            {{ if .Site.Params.misc }}
            {{ end }}
            {{ if .Site.Params.source }}
            source,
            {{ end }}
        ]

        commands = command.split(/[ ]+/);
        if (commands[0] == 'less') {
            useLess = true;
            commands.shift();
        } 
                    
        switch(commands[0]) {
            case 'whois':
                echoArray(whois);
                break;
            case 'social':
                echoArray(social);
                break;
            case 'work':
                echoArray(work);
                break;
            case 'education':
                echoArray(education);
                break;
            case 'skills':
                echoArray(skills);
                break;
            case 'softskills':
                echoArray(softSkills);
                break;
            case 'languages':
                echoArray(languages);
                break;
            case 'projects':
                echoArray(projects);
                break;
            case 'certifications':
                term.echo(certifications);
                break;
            case '{{ .Site.Params.misc.commandName | default "misc"}}':
                echoArray(misc);
                break;
            case 'help':
                term.echo(help);
                break;
            case 'all':
                echoArray(all.flat(1));
                break;
            {{ if .Site.Params.startxLocation }}
            case 'startx':
                term.echo("loading ...");
                loading();
                setTimeout(function(){window.location = "{{ .Site.Params.startxLocation }}"}, 2000);
                break;
            {{ end }}
            case ':(){:|:&};:':
                term.echo("nice try");
                break;
            case 'source':
                term.echo(source);
                break;
            {{ if .Site.Params.exitLocation }}
            case 'exit':
                term.echo("terminating ... ")
                loading();
                setTimeout(function(){window.location = '{{ .Site.Params.exitLocation }}'}, 2000);
                break;
            {{ end }}
            {{ if .Site.Params.version }}
            case 'version':
                term.echo("{{ .Site.Params.version }}");
                break;
            {{ end }}
            case '':
                break;
            default:
                term.echo("\nunknown command: " + command + "\n" +
                          "please type 'help' for a list of available commands\n");
        }
    }, {
        prompt: '[[;{{ .Site.Params.promptColor | default "grey" }};]{{ .Site.Params.prompt }}][[;{{ .Site.Params.promptSimbolsColor | default "grey" }};]{{.Site.Params.promptSimbols | default ":~$"}}]' + " ",
        greetings: "[[b;{{ .Site.Params.greetingColor | default "white" }};]{{ .Site.Params.greeting }}]",

        keydown: function(e, term) {
            if (animation) {
                if (e.which == 68 && e.ctrlKey) { // CTRL+D
                    clearTimeout(timer);
                    animation = false;
                    term.echo(string + ' [[b;red;]FAIL]')
                    .set_prompt(prompt);
                }
                return false;
            }
        },
        autocompleteMenu: true,
        completion: availableCommands
        
    });
});
</script>
{{ end }}
